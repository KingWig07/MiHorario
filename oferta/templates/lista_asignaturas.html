{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

    <!-- Título de la página -->
    <h1 class="text-3xl font-bold mb-6">Oferta académica</h1>

    <!-- Filtros de búsqueda -->
<form method="get" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-8">
    <!-- Filtro: Carrera -->
    <div>
        <label for="carrera" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Carrera</label>
        <select id="carrera" name="carrera" onchange="this.form.submit()"
            class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <option value="">Todas</option>
            {% for c in carreras %}
                <option value="{{ c }}" {% if request.GET.carrera == c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Filtro: Jornada -->
    <div>
        <label for="jornada" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Jornada</label>
        <select id="jornada" name="jornada" onchange="this.form.submit()"
            class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <option value="">Todas</option>
            {% for j in jornadas %}
                <option value="{{ j }}" {% if request.GET.jornada == j %}selected{% endif %}>{{ j }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Filtro: Nivel -->
    <div>
        <label for="nivel" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Nivel</label>
        <select id="nivel" name="nivel" onchange="this.form.submit()"
            class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <option value="">Todos</option>
            {% for n in niveles %}
                <option value="{{ n }}" {% if request.GET.nivel == n %}selected{% endif %}>{{ n }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Filtro: Asignatura -->
    <div>
        <label for="busqueda" class="block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2">Asignatura</label>
        <select id="busqueda" name="busqueda" onchange="this.form.submit()"
            class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <option value="">Todas</option>
            {% for a in asignaturas_unicas %}
                <option value="{{ a.nombre }}" {% if request.GET.busqueda == a.nombre %}selected{% endif %}>{{ a.nombre }}</option>
            {% endfor %}
        </select>
    </div>
</form>


    <!-- Tabla -->
    <div class="overflow-x-auto rounded-lg border border-gray-700 shadow">
        <table class="min-w-full text-sm text-left text-white">
            <thead class="bg-gray-800 text-xs uppercase text-gray-400">
                <tr>
                    <th class="px-4 py-3">Sigla</th>
                    <th class="px-4 py-3">Nombre</th>
                    <th class="px-4 py-3">Sección</th>
                    <th class="px-4 py-3">Docente</th>
                    <th class="px-4 py-3">Horario(s)</th>
                    <th class="px-4 py-3">Online</th>
                    <th class="px-4 py-3">Acción</th>
                </tr>
            </thead>
            <tbody class="bg-gray-900 divide-y divide-gray-700">
                {% for a in asignaturas %}
                <tr>
                    <td class="px-4 py-2">{{ a.sigla }}</td>
                    <td class="px-4 py-2">{{ a.nombre }}</td>
                    <td class="px-4 py-2">{{ a.seccion }}</td>
                    <td class="px-4 py-2">
                        {% if a.docente and a.docente|lower != "nan" %}
                            {{ a.docente }}
                        {% else %}
                            <span class="italic text-gray-400">No asignado</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-2">
                        {% for h in a.horarios.all %}
                            {{ h.dia }} {{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fin|time:"H:i" }}<br>
                        {% endfor %}
                    </td>
                    <td class="px-4 py-2">
                        {% if a.virtual_sincronica == "True" %}
                            <span class="text-green-600 font-semibold">Sí</span>
                        {% else %}
                            <span class="text-gray-500">No</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-2">
                        <button class="bg-sky-600 hover:bg-sky-700 text-white text-xs px-3 py-1 rounded seleccionar-btn"
                                data-id="{{ a.id }}"
                                data-sigla="{{ a.sigla }}"
                                data-virtual="{{ a.virtual_sincronica }}"
                                data-nombre="{{ a.nombre }}"
                                data-seccion="{{ a.seccion }}"
                                data-horarios='[
                                    {% for h in a.horarios.all %}
                                        {"dia": "{{ h.dia }}", "inicio": "{{ h.hora_inicio|time:"H:i" }}", "fin": "{{ h.hora_fin|time:"H:i" }}"}{% if not forloop.last %},{% endif %}
                                    {% endfor %}
                                ]'>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="px-4 py-4 text-center text-gray-400">No hay asignaturas disponibles</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Paginación -->
    <nav class="mt-6 flex justify-center items-center space-x-2 text-sm">
        {% if asignaturas.has_previous %}
            <a href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ asignaturas.previous_page_number }}"
            class="px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600">
                &laquo; Anterior
            </a>
        {% else %}
            <span class="px-3 py-1 bg-gray-800 text-gray-500 rounded cursor-not-allowed">&laquo; Anterior</span>
        {% endif %}

        <span class="px-3 py-1 bg-gray-800 text-gray-300 rounded">
            Página {{ asignaturas.number }} de {{ asignaturas.paginator.num_pages }}
        </span>

        {% if asignaturas.has_next %}
            <a href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ asignaturas.next_page_number }}"
            class="px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600">
                Siguiente &raquo;
            </a>
        {% else %}
            <span class="px-3 py-1 bg-gray-800 text-gray-500 rounded cursor-not-allowed">Siguiente &raquo;</span>
        {% endif %}
    </nav>

    <!-- Horario -->
    <div id="horario" class="mt-4 mb-4"></div>

</div>

<!-- JS -->
<script src="{% static 'js/script.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
{% endblock %}
